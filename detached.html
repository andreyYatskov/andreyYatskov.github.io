<!doctype html>
<html>
   <head>
    <title>Testing Apester</title>
    <meta charset="UTF-8" />
    <meta property="og:type" content="article" />
    <meta name="title" content="Testing Apaester" />
    <meta name="description" content="Test page" />
    <meta property="article:published_time" content="2023-08-30T11:13:19+00:00" />
    <meta name="image" content="https://img.apester.com/insecure/fit/122/122/ce/0/plain/user-images%2F43%2F43a8300e9f75dbfd532315796175a1c5.jpeg" />
    <style>
        body {margin: 0;}
        .hidden {display: "none";}
    </style>
  </head>
  <body>
      <div class="configuration hidden">
          <div style="margin: 20px 0">
              <label for="platform">Platform:</label>
              <select id="platform">
                  <option value="mobile" selected="selected">mobile</option>
                  <option value="desktop">desktop</option>
              </select>
          </div>
          <div style="margin: 20px 0">
              <label for="os">OS:</label>
              <select id="os">
                  <option value="ios" selected="selected">IOS</option>
                  <option value="android">android</option>
              </select>
          </div>
          <div style="margin: 20px 0">
             <input type="checkbox" id="isWebview">
              <label for="">OS:</label>
              <select id="os">
                  <option value="ios" selected="selected">IOS</option>
                  <option value="android">android</option>
              </select>
          </div>
          <div style="margin: 20px 0">
              <label for="channelToken">Channel token:</label>
              <input type="text" id="input-channel" name="channelToken" value="" style="width: 306px">
          </div>  
          <button onclick="apply()">Apply</button>
      </div>

      <script>
        const getParams = () => {
          const url = new URL(window.location);
          const urlSearchParams = new URLSearchParams(url.search);
          return Object.fromEntries(urlSearchParams);
        };
        if (location.search) {
          const params = getParams();
          console.log('params', params);
          let userAgent = '';
          if (params.isWebview) {
            userAgent += 'Webview ';
          }
          if (params.platform === 'mobile') {
              userAgent += params.os === 'android' ? 'android' : 'iPhone';
          }  
          userAgent += 'iPhone';
          Object.defineProperty(navigator, 'userAgent', {
              get: function () { return userAgent; }
          });
        } else {
          document.querySelector(".configuration").classList.remove('hidden');
        }
        function apply() {
          const channelToken = document.getElementById("input-channel").value;
          const os = document.getElementById("os").value;
          const platform = document.getElementById("os").value;
          const isWebview = document.querySelector(`#isWebview`).checked
          window.location += `?channelToken=${channelToken}&fallback=true&isWebview=${isWebview}&os=${os}&platform=${platform}`;
        }
      </script>
      <script src="https://static.apester.com/js/sdk/latest/apester-sdk.js"></script>
      <script src="https://renderer.apester.com/v2/static/in-app-runtime.js"></script>
      <script src="https://renderer.apester.com/v2/static/in-app-inAppUnitBridge.bundle.js"></script>
  </body>
</html>
